#!/bin/sh
set -eu

commit_msg_file="$1"
first_line="$(head -n 1 "$commit_msg_file" | tr -d '\r')"

# merge / rebase 작업용 커밋은 허용
case "$first_line" in
  Merge\ *|Revert\ *|fixup!\ *|squash!\ *)
    exit 0
    ;;
esac

# [#12] feat: message
# [#12] fix(auth): message
pattern='^\[#([0-9]+)\][[:space:]]+(feat|fix|docs|style|refactor|test|chore)(\([^)]+\))?:[[:space:]]+.+'

if ! printf "%s" "$first_line" | grep -Eq "$pattern"; then
  echo "❌ 커밋 메시지 형식이 올바르지 않습니다."
  echo ""
  echo "형식:"
  echo "  [#이슈번호] type(scope): 한 줄 요약"
  echo ""
  echo "예시:"
  echo "  [#12] feat: websocket 채팅 기본 구조 구현"
  echo "  [#103] fix(auth): 토큰 만료 처리"
  echo ""
  echo "현재 입력:"
  echo "  $first_line"
  exit 1
fi
