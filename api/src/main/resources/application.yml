server:
  port: 8080

spring:
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}
  devtools:
    restart:
      enabled: false
  application:
    name: api
  autoconfigure:
    exclude:
      - org.springframework.boot.elasticsearch.autoconfigure.ElasticsearchClientAutoConfiguration
      - org.springframework.boot.data.elasticsearch.autoconfigure.DataElasticsearchAutoConfiguration
  data:
    redis:
      host: localhost
      port: 6379
      password: ${REDIS_PASSWORD:}
      username: default
  jpa:
    open-in-view: false
    hibernate:
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
    properties:
      jakarta.persistence.lock.timeout: 5000 # jpa lock timeout 5 seconds
      hibernate:
        default_batch_fetch_size: 100

  security:
    oauth2:
      client:
        provider:
          kakao:
            authorization-uri: https://kauth.kakao.com/oauth/authorize
            token-uri: https://kauth.kakao.com/oauth/token
            user-info-uri: https://kapi.kakao.com/v2/user/me
            user-name-attribute: id
          naver:
            authorization-uri: https://nid.naver.com/oauth2.0/authorize
            token-uri: https://nid.naver.com/oauth2.0/token
            user-info-uri: https://openapi.naver.com/v1/nid/me
            user-name-attribute: response
  cloud:
    gateway:
      globalcors:
        cors-configurations:
          '[/**]':
            allowedOrigins:
              - "http://localhost:3000"
              - "http://127.0.0.1:3000"
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowedHeaders: "*"
            allowCredentials: true
      routes:
        - id: member
          uri: http://${services.member.host}:8086
          predicates:
            - Path=/api/v1/members/**,/api/v2/members/**,/api/v1/auths/**,/api/v2/auths/**

#        - id: auth
#          uri: http://${services.auth.host}:8087
#          predicates:
#            - Path=/api/v1/auths/**,/api/v2/auths/**

        - id: product
          uri: http://${services.product.host}:8081
          predicates:
            - Path=/api/v1/products/**,/api/v2/products/**

#        - id: order
#          uri: http://${services.order.host}:8082
#          predicates:
#            - Path=/api/v1/orders/**,/api/v2/orders/**

        - id: payment-service
          uri: http://${services.payment.host}:8083
          predicates:
            - Path=/api/v1/payments/**,/api/v2/payments/**

        - id: settlement-service
          uri: http://${services.settlement.host}:8084
          predicates:
            - Path=/api/v1/settlements/**,/api/v2/settlements/**

        - id: file
          uri: http://${services.file.host}:8088
          predicates:
            - Path=/api/v1/files/**,/api/v2/files/**

        - id: content
          uri: http://${services.content.host}:8089
          predicates:
            - Path=/api/v1/contents/**,/api/v2/contents/**
  batch:
    job:
      enabled: false
    jdbc:
      initialize-schema: always
  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

  jackson:
    serialization:
      fail-on-empty-beans: false

  elasticsearch:
    connect-timeout: 3s
    socket-timeout: 10s

  kafka:
    bootstrap-servers: ${KAFKA_BOOTSTRAP_SERVERS:localhost:29092}
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JacksonJsonSerializer
      acks: all # 모든 레플리카 확인
      retries: 3
      properties:
        "enable.idempotence": true # 중복 방지
        "spring.json.add.type.headers": true # 타입 헤더 추가 / consumer 가 해당 타입으로 역직렬화 가능
        "spring.json.trusted.packages": com.modeunsa.*
        "delivery.timeout.ms": 120000 # 전송 타임아웃
    consumer:
      group-id: modeunsa-group
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      auto-offset-reset: earliest
      properties:
        "spring.json.trusted.packages": com.modeunsa.*
        "spring.json.use.type.headers": true
        "max.poll.records": 20 # 폴링 레코드 수
        "fetch.max.wait.ms": 500 # 최대 대기 시간
        "max.poll.interval.ms": 300000 # 최대 풀 대기 시간

settlement:
  scheduler:
    daily-03: "0 0 3 * * *"
    monthly-25-04: "0 0 4 25 * *"
  policy:
    fee-rate: 0.1
  member:
    system-member-id: 1

jwt:
  secret: ${JWT_SECRET:local-test-jwt-secret-key-which-is-long-enough-32bytes}
  access-token-expiration: 1800000   # 30분
  refresh-token-expiration: 604800000 # 7일

payment:
  accounts:
    system-member-id: 1
    holder-member-id: 2
  toss:
    base-url: ${TOSS_API_BASE_URL:https://api.tosspayments.com}
    confirm-path: ${TOSS_API_CONFIRM_PATH:/v1/payments/confirm}
    secret-key: ${TOSS_PAYMENTS_SECRET_KEY:}

cloud:
  aws:
    credentials:
      access-key: ${AWS_ACCESS_KEY}
      secret-key: ${AWS_SECRET_KEY}
    region:
      static-region: ap-northeast-2
    s3:
      bucket: team01-storage
    stack:
      auto: false

custom:
  global:
    internalBackUrl: http://localhost:${server.port:8080}
    productInternalBackUrl: http://localhost:8081
#  security:
#    # TODO: 추후 인증 연결
#    permit-all: true

encryption:
  enabled: false
  master-key: ${ENCRYPTION_MASTER_KEY}

app:
  simulation:
    enabled: true
  event-publisher:
    type: ${EVENT_PUBLISHER_TYPE:spring}
  data-init:
    enabled: ${DATA_INIT:true}

internal:
  api-key: ${INTERNAL_API_KEY}